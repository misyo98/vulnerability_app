class VulnerabilitysController < ApplicationController

  def index
    @vulnerabilitys = Vulnerability.all
  end

  def upload
    csv_path = File.join Rails.root, 'tmp', 'vulnerability.csv'
    VulnerabilityAddWorker.perform_async(csv_path)
    redirect_to vulnerabilitys_path
  end

  def destroy_all
    VulnerabilityRemoveWorker.perform_async
    redirect_to vulnerabilitys_path
  end

end


def upload
  csv_path = File.join Rails.root, 'tmp', 'vulnerability.csv'
  CSV.foreach((csv_path), headers: true) do |vulnerability|
    Vulnerability.create(
      gem_name: vulnerability[0],
      bundle_version: vulnerability[1],
      newest_version: vulnerability[3],
      status: vulnerability[4])
    end
    redirect_to vulnerabilitys_path
  end

  def destroy_all
    Vulnerability.destroy_all
    redirect_to vulnerabilitys_path
  end
